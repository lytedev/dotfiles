#!/usr/bin/env bash

set -x

umask 077
d="$(date +"%Y-%m-%d_%H-%M-%S")"
fn="$SCROTS_PATH/clipshot_$d.png"

if is_wayland; then
	dim="$(slurp -d)"
	if [ $? -eq 0 ]; then
		grim -g "$dim" - | wl-copy
		wl-paste -n > "$fn"
		echo "$fn"
		# grim -g "$dim" - | tee "$fn" | wl-copy -f
	else
		exit 1
	fi
else
	pkill unclutter
	sleep 0.1
	import "$fn"
	< "$fn" xclip -t image/png -i -selection clipboard
	< "$fn" xclip -t image/png -i -selection primary
	< "$fn" xclip -t image/png -i -selection secondary
	< "$fn" xclip -t image/png -i -selection buffer-cut
	unclutter &
	echo "$fn"
fi
set -x
