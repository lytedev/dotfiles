#!/usr/bin/env bash

function debug_msg {
	(>&2 echo "DEBUG: $1")
}

export CUR_SESSION_PREFIX="#[bg=colour1] "
export CUR_SESSION_SUFFIX=" #[bg=default]"

if [ -z "$1" ]; then
	export CUR_TMUX_SESSION="$(tmux display-message -p '#S')"
else
	export CUR_TMUX_SESSION="$1"
fi

export TMUX_SESSION_LIST=" $(tmux list-sessions | sed -ne 's/^\([^:]*\).*$/ \1 /p' | tr '\n' ' ' | xargs)"


HIGHLIGHT_CUR_SESSION="${TMUX_SESSION_LIST/ $CUR_TMUX_SESSION / ${CUR_SESSION_PREFIX}${CUR_TMUX_SESSION}${CUR_SESSION_SUFFIX} }"

ADD_END_SPACE_IF_NECESSARY=$(echo "$HIGHLIGHT_CUR_SESSION" | sed -e 's/\([^]]\)$/\ /p')
REMOVE_START_SPACE_IF_NECESSARY=$(echo "$ADD_END_SPACE_IF_NECESSARY" | sed 's/^ #/#/')

echo "$REMOVE_START_SPACE_IF_NECESSARY"
